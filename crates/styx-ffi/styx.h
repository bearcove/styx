/* Generated by cbindgen - do not edit manually */

#ifndef STYX_H
#define STYX_H

#include <stdint.h>
#include <stdbool.h>
#include <stddef.h>

/**
 * Type of a Styx value's payload.
 */
typedef enum StyxPayloadKind {
  /**
   * No payload (unit or tag-only).
   */
  STYX_PAYLOAD_KIND_NONE,
  /**
   * Scalar text.
   */
  STYX_PAYLOAD_KIND_SCALAR,
  /**
   * Sequence of values.
   */
  STYX_PAYLOAD_KIND_SEQUENCE,
  /**
   * Object (key-value pairs).
   */
  STYX_PAYLOAD_KIND_OBJECT,
} StyxPayloadKind;

/**
 * Opaque handle to a parsed Styx document.
 */
typedef struct StyxDocument StyxDocument;

/**
 * Opaque handle to a Styx object.
 */
typedef struct StyxObject StyxObject;

/**
 * Opaque handle to a Styx sequence.
 */
typedef struct StyxSequence StyxSequence;

/**
 * Opaque handle to a Styx value.
 */
typedef struct StyxValue StyxValue;

/**
 * Result of a parse operation.
 */
typedef struct StyxParseResult {
  /**
   * The parsed document (null if error).
   */
  struct StyxDocument *document;
  /**
   * Error message (null if success). Must be freed with `styx_free_string`.
   */
  char *error;
} StyxParseResult;

/**
 * Parse a Styx document from a UTF-8 string.
 *
 * # Safety
 * - `source` must be a valid null-terminated UTF-8 string.
 * - The returned `StyxParseResult` must have its fields freed appropriately:
 *   - If `document` is non-null, free it with `styx_free_document`.
 *   - If `error` is non-null, free it with `styx_free_string`.
 */
struct StyxParseResult styx_parse(const char *source);

/**
 * Free a parsed document.
 *
 * # Safety
 * - `doc` must be a valid pointer returned by `styx_parse`, or null.
 * - After calling this function, `doc` is invalid and must not be used.
 */
void styx_free_document(struct StyxDocument *doc);

/**
 * Free a string returned by the library.
 *
 * # Safety
 * - `s` must be a valid pointer returned by a styx_* function, or null.
 */
void styx_free_string(char *s);

/**
 * Get the root object of a document.
 *
 * # Safety
 * - `doc` must be a valid pointer to a `StyxDocument`.
 * - The returned pointer is valid as long as `doc` is valid.
 */
const struct StyxObject *styx_document_root(const struct StyxDocument *doc);

/**
 * Get a value by path from a document.
 *
 * # Safety
 * - `doc` must be a valid pointer to a `StyxDocument`.
 * - `path` must be a valid null-terminated UTF-8 string.
 * - The returned pointer is valid as long as `doc` is valid.
 */
const struct StyxValue *styx_document_get(const struct StyxDocument *doc, const char *path);

/**
 * Get the payload kind of a value.
 *
 * # Safety
 * - `value` must be a valid pointer to a `StyxValue`.
 */
enum StyxPayloadKind styx_value_payload_kind(const struct StyxValue *value);

/**
 * Check if a value is unit (no tag, no payload).
 *
 * # Safety
 * - `value` must be a valid pointer to a `StyxValue`.
 */
bool styx_value_is_unit(const struct StyxValue *value);

/**
 * Get the tag name of a value (null if no tag).
 *
 * # Safety
 * - `value` must be a valid pointer to a `StyxValue`.
 * - The returned string must be freed with `styx_free_string`.
 */
char *styx_value_tag(const struct StyxValue *value);

/**
 * Get the scalar text of a value (null if not a scalar).
 *
 * # Safety
 * - `value` must be a valid pointer to a `StyxValue`.
 * - The returned string must be freed with `styx_free_string`.
 */
char *styx_value_scalar(const struct StyxValue *value);

/**
 * Get the object payload of a value (null if not an object).
 *
 * # Safety
 * - `value` must be a valid pointer to a `StyxValue`.
 * - The returned pointer is valid as long as the parent document is valid.
 */
const struct StyxObject *styx_value_as_object(const struct StyxValue *value);

/**
 * Get the sequence payload of a value (null if not a sequence).
 *
 * # Safety
 * - `value` must be a valid pointer to a `StyxValue`.
 * - The returned pointer is valid as long as the parent document is valid.
 */
const struct StyxSequence *styx_value_as_sequence(const struct StyxValue *value);

/**
 * Get a nested value by path.
 *
 * # Safety
 * - `value` must be a valid pointer to a `StyxValue`.
 * - `path` must be a valid null-terminated UTF-8 string.
 * - The returned pointer is valid as long as the parent document is valid.
 */
const struct StyxValue *styx_value_get(const struct StyxValue *value, const char *path);

/**
 * Get the number of entries in an object.
 *
 * # Safety
 * - `obj` must be a valid pointer to a `StyxObject`.
 */
uintptr_t styx_object_len(const struct StyxObject *obj);

/**
 * Get a value from an object by key.
 *
 * # Safety
 * - `obj` must be a valid pointer to a `StyxObject`.
 * - `key` must be a valid null-terminated UTF-8 string.
 * - The returned pointer is valid as long as the parent document is valid.
 */
const struct StyxValue *styx_object_get(const struct StyxObject *obj, const char *key);

/**
 * Get the key at a given index in an object.
 *
 * # Safety
 * - `obj` must be a valid pointer to a `StyxObject`.
 * - `index` must be less than `styx_object_len(obj)`.
 * - The returned pointer is valid as long as the parent document is valid.
 */
const struct StyxValue *styx_object_key_at(const struct StyxObject *obj, uintptr_t index);

/**
 * Get the value at a given index in an object.
 *
 * # Safety
 * - `obj` must be a valid pointer to a `StyxObject`.
 * - `index` must be less than `styx_object_len(obj)`.
 * - The returned pointer is valid as long as the parent document is valid.
 */
const struct StyxValue *styx_object_value_at(const struct StyxObject *obj, uintptr_t index);

/**
 * Get the number of items in a sequence.
 *
 * # Safety
 * - `seq` must be a valid pointer to a `StyxSequence`.
 */
uintptr_t styx_sequence_len(const struct StyxSequence *seq);

/**
 * Get an item from a sequence by index.
 *
 * # Safety
 * - `seq` must be a valid pointer to a `StyxSequence`.
 * - `index` must be less than `styx_sequence_len(seq)`.
 * - The returned pointer is valid as long as the parent document is valid.
 */
const struct StyxValue *styx_sequence_get(const struct StyxSequence *seq, uintptr_t index);

#endif  /* STYX_H */
